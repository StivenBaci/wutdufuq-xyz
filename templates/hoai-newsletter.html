<form id="regForm" action="">
  <div class="form-container">
  <div class="form-container-vertical">  
    <h1>Newsletter</h1>
    <p>Melden Sie sich zu unserem HOAI.de Newsletter an, um auf dem Laufenden zu bleiben.</p>
    <!-- One "tab" for each step in the form: -->
    <div class="tab">
      <p>
        <select placeholder="Titel" name="titel" oninput="this.className = ''">
          <option selected hidden value="">Titel</option>
          <option value="Dr.">Dr.</option>
          <option value="Prof. Dr.">Prof. Dr.</option>
        </select>
      </p>
      <p>
        <select placeholder="Anrede" name="anrede" oninput="this.className = ''">
          <option selected hidden value="">Anrede</option>
          <option value="m">Herr</option>
          <option value="f">Frau</option>
          <option value="">Divers</option>
        </select>
      </p>
      <p><input placeholder="Vorname" oninput="this.className = ''" ></p>
      <p><input placeholder="Nachname" oninput="this.className = ''"></p>
      <p class="helper-before">Geben Sie Ihre E-Mail-Adresse ein, um sich anzumelden<span class="required_span">*</span></p>
      <p><input type="email" placeholder="E-Mail-Adresse" oninput="this.className = ''" required></p>
      <p class="helper-after">Geben Sie bitte Ihre E-Mail-Adresse für die Anmeldung an, z. B. abc@xyz.com.</p>
      <div class="container-row" data-required="true">
        <label>
          <input placeholder='datenschutz' type="checkbox" id="datenschutz" value=true required>
          <span>Ich möchte Ihren Newsletter erhalten und akzeptiere die <a href="https://www.hoai.de/datenschutz/">Datenschutzerklärung*</a>.</span>
        </label>
      </div>

    </div>

    <div class="tab">
      <p>
        <select placeholder="Art der Beschäftigung" name="Art der Beschäftigung" oninput="this.className = ''">
          <option selected hidden value="">Art der Beschäftigung</option>
          <option value="selbstständig">Selbstständig</option>
          <option value="angestellt">Angestellt</option>
          <option value="sonstiges">Sonstiges</option>
        </select>
      </p>
      <p>
        <select placeholder="Rolle" name="Rolle" oninput="this.className = ''">
          <option selected hidden value="">Rolle</option>
          <option value="auftraggeber">Auftraggeber</option>
          <option value="auftragnehmer">Auftragnehmer</option>
          <option value="beides">Beides</option>
        </select>
      </p>
      <p>
        <select placeholder="Bereich" name="Bereich" oninput="this.className = ''">
          <option selected hidden value="">Bereich</option>
          <option value="öffentlich">Öffentlich</option>
          <option value="privatwirtschaftlich">Privatwirtschaftlich</option>
        </select>
      </p>
      <p>
        <select placeholder="Funktion" name="Funktion" oninput="this.className = ''">
          <option selected hidden value="">Funktion</option>
          <option value="architekt">Architekt</option>
          <option value="ingenieur">Ingenieur</option>
          <option value="kaufmännisch">Kaufmännisch</option>
          <option value="rechtsanwalt">Rechtsanwalt</option>
          <option value="assistenz">Assistenz</option>
          <option value="Sonstige">Sonstige</option>
        </select>
      </p>
      <p><input placeholder="Postleitzahl" oninput="this.className = ''"></p>
    </div>

    <div style="overflow:auto;">
      <div style="float:right;">
        <button type="button" id="prevBtn" onclick="nextPrev(-1)">Zurück</button>
        <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
        <button type="button" id="submitBtn" onclick="submitForm()">Anmelden</button>
      </div>
    </div>

    <!-- Circles which indicates the steps of the form: -->
    <div style="text-align:center;margin-top:40px;">
      <span class="step"></span>
      <span class="step"></span>
    </div>
  </div>  
  </div>
</form>
  
  <style>
    /* Style the form */
    #regForm {
      display: flex;
      justify-content: center;
      text-align: center;
      background-color: #EFF2F7;
      background-attachment: fixed;
      font-size: 16px;
      font-family: Roboto, sans-serif;
      padding: 32px 12px 32px;
      margin: 0;
      line-height: 1.5em;
    }
    
    #regForm a {
      color: #0092ff;!important;
    }

    .form-container {
      box-sizing: border-box;
    }

    .form-container-vertical {
      text-align: center;
      background-color: rgba(255, 255, 255, 1);
      max-width: 540px;
      border-radius: 3px;
      border-width: 1px;
      border-color: #C0CCD9;
      border-style: solid;
      padding: 32px 12px 32px;
    }

  
    button  {
      font-size: 16px;
      text-align: left;
      font-weight: 700;
      font-family: "Helvetica", sans-serif;
      color: #FFFFFF;
      background-color: #3E4857;
      border-radius: 3px;
      border-width: 0px;
      min-height: 40px;
      line-height: 23px;
      display: inline-block;
      padding: 8px 18px;
      border: none;
      overflow-wrap: break-word;
      max-width: 100%;
      cursor: pointer;
    }
  
    /* Style the input fields */
  
    select {
      padding: 10px;
      width: 100%;
      font-size: 17px;
      font-family: Raleway;
      border: 1px solid #aaaaaa;
    }
  
  
    input {
      padding: 10px;
      width: 100%;
      font-size: 17px;
      font-family: Raleway;
      border: 1px solid #aaaaaa;
    }
  
  
    input[type=submit] {
        background-color: #FFC0CB;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
    }

    input[type=checkbox] {
      margin-left: 0.5em;
      margin-right: 0.5em;
      border-radius: 3px;
      background: #fff;
      border: 1px solid #687484;
      cursor: pointer;
      display: inline-block;
      height: 1em;
      vertical-align: -0.125em;
      width: 1em;
      position: relative;
    }

    #regForm input:not(textarea) {
      height: calc(2.5rem - 2px);
    }
  
    label {
      display: inline-flex;
      align-items: flex-start;
      font-size: 18px;
    }

    .helper-before {
      font-size: 16px;
      text-align: left;
      font-weight: 700;
      font-family: "Helvetica", sans-serif;
      color: #3c4858;
    }

    .helper-after {
      font-size: 12px;
      text-align: left;
      font-family: "Helvetica", sans-serif;
      color: #8390A4;
      text-align: left;
    }
    
    .container-row {
      display: flex;
      text-align: left;
      margin-bottom: 10px;
    }

    .required_span {
      color: #ff4949;
    }
  
    /* Hide all steps by default: */
    .tab {
      display: none;
    }
  
    /* Make circles that indicate the steps of the form: */
    .step {
      height: 15px;
      width: 15px;
      margin: 0 2px;
      background-color: #bbbbbb;
      border: none;
      border-radius: 50%;
      display: inline-block;
      opacity: 0.5;
    }
  
    /* Mark the active step: */
    .step.active {
      opacity: 1;
    }
  
    /* Mark the steps that are finished and valid: */
    .step.finish {
      background-color: #04AA6D;
    }
  </style>
  
  
  <script>
  var currentTab = 0; // Current tab is the first tab (0)
  showTab(currentTab); // Display current tab    
  
  function showTab(n) {
    // This function will display the specified tab of the form
    var x = document.getElementsByClassName("tab");
    x[n].style.display = "block";
    // fix the Previous/Next buttons:
    if (n == 0) {
      document.getElementById("prevBtn").style.display = "none";
    } else {
      document.getElementById("prevBtn").style.display = "inline";
    }
    if (n == (x.length - 1)) {
      document.getElementById("nextBtn").remove();
    } else {
      document.getElementById("nextBtn").innerHTML = "Nächste Schritt";
    }
    fixStepIndicator(n)
  }
  
  function nextPrev(n) {
    // This function will figure out which tab to display
    var x = document.getElementsByClassName("tab");
    // Exit the function if any field in the current tab is invalid:
    if (n == 1 && !validateForm()) return false;
    if (n == 1 && validateForm()) submitForm();
    // Hide the current tab:
    x[currentTab].style.display = "none";
    // Increase or decrease the current tab by 1:
    currentTab = currentTab + n;
    // if you have reached the end of the form... :
    if (currentTab >= x.length) {
      //...the form gets submitted:
      document.getElementById("regForm").submit();
      return false;
    }
    // Otherwise, display the correct tab:
    showTab(currentTab);
  }
  
  function validateForm() {
    // This function deals with validation of the form fields
    var x, y, i, valid = true;
    x = document.getElementsByClassName("tab");
    y = x[currentTab].querySelectorAll("[required]");
  
    for (i = 0; i < y.length; i++) {
      if (y[i].value == "" && !y[i].reportValidity()) {
        y[i].className += " invalid";
        valid = false;
      }
    }
  
    if (!document.getElementById("datenschutz").checked ) {
      console.log("Datenschutz required!");
      return false; // Prevents form submission
    }
  
    // If the valid status is true, mark the step as finished and valid:
    if (valid) {
      document.getElementsByClassName("step")[currentTab].className += " finish";
    }
    return valid; // return the valid status
  }
  
  function fixStepIndicator(n) {
    // This function removes the "active" class of all steps...
    var i, x = document.getElementsByClassName("step");
    for (i = 0; i < x.length; i++) {
      x[i].className = x[i].className.replace(" active", "");
    }
    //... and adds the "active" class to the current step:
    x[n].className += " active";
  }
  
  function submitForm() {
    const formData = {};
  
    const tabs = document.getElementsByClassName("tab");
  
    // Iterate through each tab and collect input values
    for (let i = 0; i < tabs.length; i++) {
      const inputs = tabs[i].querySelectorAll("input, select");
  
      // Iterate through each input and create a key-value pair in formData
      for (let j = 0; j < inputs.length; j++) {
        const inputName = inputs[j].getAttribute("placeholder");
  
  
        // Ensure `inputName` is valid before using it
        if (!inputName) {
          continue; // Skip inputs without placeholders
        }
        formData[inputName] = inputs[j].value;
      }
    }
  
    // Validation
    if (!validateForm() ) {
      console.log('Validation failed.');
      return false; // Prevents form submission
    }
  
    // formData and input values are validated
    
    
    // API Request to Lambda Function
    console.log("Submitting form data:", formData); 
    // Convert the formData object to JSON and format for Maileon
  
    userEmail = formData["E-Mail-Adresse*"]
  
    maileonData = {
      "custom_fields": {
                        "Datenschutz": formData['datenschutz'],
                        "Art der Beschäftigung": ['Art der Bechäftigung'],
                        "Rolle": formData['Rolle'],
                        "Bereich": formData['Bereich'],
                        "Funktion": formData['Funktion'],
                        "datasource": 'Reg-03'
                        },
      "standard_fields": {
                          "userEmail": formData["E-Mail-Adresse*"],
                          "FIRSTNAME": formData["Vorname"],
                          "LASTNAME": formData["Nachname"],
                          "PLZ": formData['Postleitzahl'],
                          "ANREDE": formData["Anrede"],
                          "Titel": formData["Titel"]
                        } 
    };
    console.log(maileonData);
    //(TO-DO: Ideally send the data straight to Maileon, requires a safe environment for the api key.)
  
    const url = 'https://.lambda-url.eu-central-1.on.aws/'
    fetch(url, {
      method: 'POST',
      body: JSON.stringify(maileonData),
    })
      .then(response => response.json())
      .then(data => console.log(data))
      .catch(error => console.error(error));
  }
  </script>
  